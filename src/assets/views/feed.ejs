<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= feed.title %></title>
    <!-- <link rel="stylesheet" href="/css/default.css"> -->
    <link rel="stylesheet" href="https://unpkg.com/98.css">
</head>
<body style="background-color: rgb(5, 5, 5);">
    <section>
        <div class="window" style="width: 90%; margin: 0 auto">
            <div class="title-bar">
                <div class="title-bar-text"><%= feed.title %></div>
                <div class="title-bar-controls">
                <button aria-label="Minimize"></button>
                <button aria-label="Maximize"></button>
                <button aria-label="Close"></button>
                </div>
            </div>
            <div class="window-body">
                <h4><a href="<%= feed.link %>"><%= feed.title %></a></h4>
                <h5><%= feed.description %></h5>

                <section class="items" style="display: grid; grid-template-columns: repeat(1, 1fr); column-gap: 10px;">
                    <table class="interactive" style="width: 100%; height: 100%">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Content</th>
                                <th>Publication Date</th>
                            </tr>
                        </thead>
                        <tbody>
                        <% feed.items.forEach(element => { %>
                        <tr data-content="<%= element.content %>" data-title="<%= element.title %>" data-link="<%= element.link %>" data-pubdate="<%= element.pubDate %>">
                            <td><%= element.title %></td>
                            <td><%= element.contentSnippet.length > 21 ? element.contentSnippet.substring(0, 21) + '...' : element.contentSnippet %></td>
                            <td><%= element.pubDate %></td>
                        </tr>
                        <% }) %>
                        </tbody>
                    </table>
                    <div class="selected">
                        <div class="window" style="width: 100%; height:100%">
                            <div class="title-bar">
                                <div class="title-bar-text">A Window With Stuff In It</div>
                                <div class="title-bar-controls">
                                <button aria-label="Close" onclick="javascript:closebtn()"></button>
                                </div>
                            </div>
                            <div class="window-body">
                                <a href="This is the link">
                                    <h4>
                                    
                                    </h4>
                                </a>
                                <span></span>

                                <p>This is the content</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </section>
</body>
</html>

<script>
function clearHighlight() {
    const highlightedClass = 'highlighted';
    const previouslySelectedRow = document.querySelector('tbody tr.highlighted');
    if(previouslySelectedRow){
        previouslySelectedRow.classList.remove(highlightedClass);
    }
}
function highlight(row) {
    const highlightedClass = 'highlighted';
    document.querySelector("section.items").style.gridTemplateColumns = `repeat(2, 1fr)`;
    document.querySelector('.selected').style.display='block';
    row.classList.add(highlightedClass);
}

document.querySelectorAll('table.interactive').forEach(element => {
    element.addEventListener('click', (event) => {
        const isRow = element => element.tagName === 'TR' && element.parentElement.tagName === 'TBODY';
        const newlySelectedRow = event.composedPath().find(isRow);
        
        if (newlySelectedRow) {
            clearHighlight();
            highlight(newlySelectedRow);
            openbtn(newlySelectedRow);
        }
    })
});
function openbtn(row){
    console.log(row.dataset);
    document.querySelector(".selected .title-bar-text").innerText = row.dataset.title
    document.querySelector(".selected .window-body h4").innerText = row.dataset.title
    document.querySelector(".selected .window-body a").href = row.dataset.link
    document.querySelector(".selected .window-body span").innerText = row.dataset.pubdate
    document.querySelector(".selected .window-body p").innerHTML = row.dataset.content
    /* 
    data-content
    data-title
    data-link
    data-pubdate
    */
}
function closebtn(){
    document.querySelector('.selected').style.display='none'
    document.querySelector("section.items").style.gridTemplateColumns = `repeat(1, 1fr)`
    clearHighlight();
}
</script>